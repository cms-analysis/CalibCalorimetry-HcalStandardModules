process PROD  = {

	source = HcalTBSource { 
		untracked vstring fileNames = { '/uscms_data/d1/jmmans/tutorial_data/HTB_011609.root' }
		untracked int32 maxEvents = -1
                untracked vstring streams = { 'HCAL_DCC020:20','HCAL_Trigger' }
	}

        module hcalPeds = HcalPedestalAnalyzer{
               untracked string outputFileMeans = 'HcalPedestalMeans.calib'               
               untracked string outputFileWidths = 'HcalPedestalWidths.calib'               
               untracked string outputFileHist = 'HcalPedestals.root'               
        }

	module unpacker = HcalRawToDigi {
                untracked int32 firstSample = 5
                untracked int32 lastSample = 14
                untracked int32 HcalFirstFED = 20
                untracked vint32 FEDs = { 20 }
		untracked bool FilterDataQuality = true
		untracked bool FilterAmplitude = false
		untracked int32 FilterAmpBegin = 4
		untracked int32 FilterAmpEnd = 7
		untracked double FilterAmpLevel = 22.0
	}

        module tbunpack = HcalTBObjectUnpacker {
                untracked int32 HcalTriggerFED  = 1
                untracked int32 HcalSlowDataFED = -1
                untracked int32 HcalTDCFED = -1
		untracked int32 HcalSourcePositionFED  = -1
                untracked bool  IncludeUnmatchedHits = false
        }

        module myfilter = HcalTBTriggerFilter {
                bool AllowPedestal = true
                bool AllowPedestalInSpill = true
                bool AllowPedestalOutSpill = true
                bool AllowLaser = false
                bool AllowLED = false
                bool AllowBeam = false
        }

	es_module = HcalDbProducer {}
	es_source es_hardcode = HcalHardcodeCalibrations {untracked vstring toGet = {"Pedestals", "PedestalWidths", "Gains", "GainWidths", "QIEShape", "QIEData", "ChannelQuality"}}

        es_source es_ascii = HcalTextCalibrations { VPSet input = {
                                              {string object = "ElectronicsMap"
                                               string file = '/uscms_data/d1/jmmans/tutorial_data/maps/hbho_ring12_tb04.txt'
                                              }
                                            }
  	}

	path p = { tbunpack, myfilter, unpacker, hcalPeds}

}
