# this configuration is supposed to be run on CMSHCAL01.CERN.CH
#
process PROD = {
   service = MessageLogger
    {
    untracked vstring destinations = { "cout" }
    untracked vstring categories = {  "DDLParser", "FwkJob", "FwkReport"}
    untracked PSet cout = {string threshold = "INFO"
                            PSet INFO        = { int32 limit = 10000 }
                            PSet DDLParser = { int32 limit = 0 }
                            PSet FwkJob = { int32 limit =10 }
                            PSet FwkReport = { int32 limit = 20 }
                            }
    }
	source = HcalTBSource { 
		untracked vstring fileNames = { 'file:/bigspool/cmsmoe3/HTBsx5_000344.root' }
//		untracked vstring fileNames = { 'file:/bigspool/cmsmoe6/HBM_014415.root' }
		untracked int32 maxEvents =1000
                untracked vstring streams = { 'HCAL_DCC020:20','HCAL_Trigger','HCAL_SlowData','HCAL_TDC:5' }
	}

	module unpacker = HcalRawToDigi {
                int32 firstSample = 0
                int32 lastSample = 9
                untracked int32 HcalFirstFED = 20
                untracked vint32 FEDs = { 20 }
		bool FilterDataQuality = false
		bool FilterAmplitude = false
		int32 FilterAmpBegin = 4
		int32 FilterAmpEnd = 7
		double FilterAmpLevel = 22.0
	}

        module analpeds = HcalPedestalAnalyzer {
//               untracked string inputPedestalsSource = 'peds_sx5_344.txt'
//               untracked string inputPedestalWidthsSource = 'widths_sx5_344.txt'
               untracked string inputPedestalsSource = 'oracle://devdb10/CMS_COND_HCAL'
               untracked string inputPedestalWidthsSource = 'oracle://devdb10/CMS_COND_HCAL'
               untracked string inputPedestalsTag = 'MICHAL_02_PEDESTALS'
               untracked string inputPedestalWidthsTag = 'MICHAL_02_PEDESTAL_WIDTHS'
               untracked int32  inputPedestalsRun = 1
//               untracked string outputPedestalsDest = 'oracle://devdb10/CMS_COND_HCAL'
//               untracked string outputPedestalsTag = 'test_pedestals_from_offlinev1'
//               untracked int32  outputPedestalsRun = 1
//               untracked string outputPedestalWidthsDest = 'oracle://devdb10/CMS_COND_HCAL'
//               untracked string outputPedestalWidthsTag = 'test_pedestal_widths_from_offline_v1'
//               untracked int32  outputPedestalWidthsRun = 1
//               untracked string outputPedestalsDest = 'peds_sx5_344_10k.txt'
//               untracked string outputPedestalWidthsDest = 'widths_sx5_344_10k.txt'
               untracked string outputFileHist = 'peds_sx5_344_dbtest.root'
               untracked int32 nevtsample = 9999999
               untracked int32 hiSaveflag = 0
               untracked int32 pedValflag = 0
	}
        module analleds = HcalLedAnalyzer {
               untracked string inputPedestalsSource = 'peds_sx5_344.txt'
               untracked string outputFileHist = 'led_sx5_344.root'
               untracked string outputFileText = 'led_sx5_344.txt'
               untracked int32 analysisflag = 2
               untracked int32 nevtsample = 9999999
               untracked int32 hiSaveflag = 1
               untracked int32 firstTS = 0
               untracked int32 lastTS = 3
        }

        es_module = HcalDbProducer {untracked string dbSource = "hardcode"}
        //es_module dbprod = HcalDbProducer {}	

	path p = { unpacker,  analpeds }

// stuff for the calibration system

  es_module dbprod = HcalDbProducer {}
  es_prefer = HcalDbProducer {}

  es_source es_hardcode = HcalHardcodeCalibrations {untracked vstring toGet = {"Pedestals", "PedestalWidths", "Gains", "GainWidths", "QIEShape", "QIEData", "ChannelQuality"}}

  es_source es_ascii = HcalTextCalibrations { VPSet input = {
    {string object = "ElectronicsMap" FileInPath file='CondFormats/HcalObjects/test/mtcc_he_only_moe3.txt'}
//    {string object = "ElectronicsMap" FileInPath file='maps/hbm_wedge1_pedled.map'}
   }  
  }

}

